server {
  bind_address = "0.0.0.0"
  bind_port = "8081"
  trust_domain = "openziti.local"
  data_dir = "/opt/spire/data/server"
  log_level = "INFO"
  
  ca_subject {
    country = ["US"]
    organization = ["OpenZiti"]
    common_name = "OpenZiti SPIRE Server"
  }
}

plugins {
  DataStore "sql" {
    plugin_data {
      database_type = "sqlite3"
      connection_string = "/opt/spire/data/server/datastore.sqlite3"
    }
  }

  NodeAttestor "docker" {
    plugin_data {
      docker_socket_path = "/var/run/docker.sock"
    }
  }

  KeyManager "memory" {
    plugin_data {}
  }

  UpstreamAuthority "disk" {
    plugin_data {
      key_file_path = "/opt/spire/data/server/ca-key.pem"
      cert_file_path = "/opt/spire/data/server/ca-cert.pem"
    }
  }
}

health_checks {
  listener_enabled = true
  bind_address = "0.0.0.0"
  bind_port = "8080"
  live_path = "/health/live"
  ready_path = "/health/ready"
}
